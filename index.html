<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Teclado Musical - STM32 Assembly</title>
        <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-dark: #0d1117;
        --bg-card: #161b22;
        --bg-code: #1c2128;
        --border-color: #30363d;
        --text-primary: #c9d1d9;
        --text-secondary: #8b949e;
        --accent-blue: #58a6ff;
        --accent-green: #3fb950;
        --accent-purple: #bc8cff;
        --accent-orange: #ff9f68;
        --accent-red: #ff7b72;
      }

      body {
        font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #0d1117 0%, #1a1f2e 100%);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
      }

      /* Header */
      .header {
        background: rgba(13, 17, 23, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-color);
        padding: 2rem 0;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
      }

      .header h1 {
        font-size: 2.5rem;
        background: linear-gradient(
          135deg,
          var(--accent-blue),
          var(--accent-purple)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
        font-weight: 700;
      }

      .header .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .chip {
        background: var(--bg-card);
        padding: 0.3rem 0.8rem;
        border-radius: 12px;
        font-size: 0.85rem;
        border: 1px solid var(--border-color);
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
      }

      .chip::before {
        content: "‚óè";
        color: var(--accent-green);
      }

      /* Container */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 3rem 2rem;
      }

      /* Navega√ß√£o */
      .nav {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        overflow-x: auto;
        padding-bottom: 0.5rem;
      }

      .nav::-webkit-scrollbar {
        height: 6px;
      }

      .nav::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 3px;
      }

      .nav-item {
        padding: 0.6rem 1.2rem;
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .nav-item:hover {
        background: var(--bg-code);
        border-color: var(--accent-blue);
        color: var(--text-primary);
      }

      .nav-item.active {
        background: var(--accent-blue);
        color: #0d1117;
        border-color: var(--accent-blue);
        font-weight: 600;
      }

      /* Code Block - IDE Style */
      .code-section {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        margin-bottom: 2rem;
        overflow: hidden;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      }

      .code-header {
        background: var(--bg-code);
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .code-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .code-title::before {
        content: "üìÑ";
      }

      .window-controls {
        display: flex;
        gap: 0.5rem;
      }

      .window-btn {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--border-color);
      }

      .window-btn:nth-child(1) {
        background: #ff5f57;
      }
      .window-btn:nth-child(2) {
        background: #ffbd2e;
      }
      .window-btn:nth-child(3) {
        background: #28ca42;
      }

      .code-content {
        padding: 1.5rem;
        background: var(--bg-code);
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        font-size: 0.9rem;
        overflow-x: auto;
        position: relative;
      }

      .code-content pre {
        margin: 0;
        line-height: 1.6;
      }

      /* Syntax Highlighting */
      .comment {
        color: #8b949e;
        font-style: italic;
      }
      .keyword {
        color: var(--accent-purple);
        font-weight: 600;
      }
      .register {
        color: var(--accent-blue);
      }
      .number {
        color: var(--accent-green);
      }
      .string {
        color: var(--accent-orange);
      }
      .label {
        color: var(--accent-red);
        font-weight: 600;
      }
      .directive {
        color: #ffa657;
      }

      /* Explanation Box */
      .explanation {
        background: linear-gradient(
          135deg,
          rgba(88, 166, 255, 0.1),
          rgba(188, 140, 255, 0.1)
        );
        border-left: 4px solid var(--accent-blue);
        padding: 1.5rem;
        margin-top: 1rem;
        border-radius: 0 8px 8px 0;
      }

      .explanation h3 {
        color: var(--accent-blue);
        margin-bottom: 0.8rem;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .explanation h3::before {
        content: "üí°";
      }

      .explanation p {
        color: var(--text-secondary);
        line-height: 1.8;
        margin-bottom: 0.8rem;
      }

      .explanation p:last-child {
        margin-bottom: 0;
      }

      .explanation strong {
        color: var(--text-primary);
      }

      /* Scroll Animations */
      .code-section {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.6s ease forwards;
      }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .code-section:nth-child(1) {
        animation-delay: 0.1s;
      }
      .code-section:nth-child(2) {
        animation-delay: 0.2s;
      }
      .code-section:nth-child(3) {
        animation-delay: 0.3s;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.8rem;
        }

        .code-content {
          font-size: 0.75rem;
          padding: 1rem;
        }

        .container {
          padding: 2rem 1rem;
        }
      }
    </style>
    </head>
    <body>
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>üéπ Teclado Musical STM32</h1>
                <div class="subtitle">
                    <span>Projeto de Microcontroladores (ELTD13A)</span>
                    <span class="chip">ARM Cortex-M3</span>
                    <span class="chip">Assembly</span>
                    <span class="chip">PWM Sound</span>
                </div>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container">
            <!-- Navigation -->
            <div class="nav">
                <div class="nav-item active"
                    onclick="scrollToSection('gpio-rcc')">
                    GPIO/RCC
                </div>
                <div class="nav-item" onclick="scrollToSection('timer-lcd')">
                    Timer/LCD
                </div>
                <div class="nav-item"
                    onclick="scrollToSection('main')">Main</div>
                <div class="nav-item" onclick="scrollToSection('config-timer')">
                    Config Timer
                </div>
                <div class="nav-item" onclick="scrollToSection('config-gpio')">
                    Config GPIO
                </div>
                <div class="nav-item"
                    onclick="scrollToSection('oitavas')">Oitavas</div>
                <div class="nav-item"
                    onclick="scrollToSection('timbre')">Timbre</div>
                <div class="nav-item" onclick="scrollToSection('leds')">VU
                    Meter</div>
                <div class="nav-item" onclick="scrollToSection('lcd')">LCD</div>
                <div class="nav-item"
                    onclick="scrollToSection('tabelas')">Tabelas</div>
                <div class="nav-item"
                    onclick="scrollToSection('scan')">Scan</div>
                <div class="nav-item"
                    onclick="scrollToSection('tocar')">Tocar</div>
                <div class="nav-item"
                    onclick="scrollToSection('melodia')">Melodia</div>
                <div class="nav-item"
                    onclick="scrollToSection('potenciometro')">
                    Potenci√¥metro
                </div>
            </div>

            <!-- Code Sections -->

            <!-- SLIDE 1: Defini√ß√µes de GPIO e RCC -->
            <div id="gpio-rcc" class="code-section">
                <div class="code-header">
                    <div class="code-title">Defini√ß√µes de Hardware - GPIO e
                        RCC</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="directive">RCC_APB1ENR</span> <span class="keyword">EQU</span> <span class="number">0x40021000+0x1C</span>  <span class="comment">; Clock dos Timers</span>

<span class="comment">; M√°scaras de configura√ß√£o</span>
<span class="directive">hab_gpioc_gpiob_gpioa_afio</span> <span class="keyword">EQU</span> <span class="number">0x1D</span>  <span class="comment">; Habilita GPIOs e AFIO</span>

<span class="comment">; Registros de configura√ß√£o da GPIOA</span>
<span class="directive">RCC_APB2ENR</span> <span class="keyword">EQU</span> <span class="number">0x40021018</span>  
<span class="directive">GPIOA_CRL</span>   <span class="keyword">EQU</span> <span class="number">0x40010800</span> 
<span class="directive">GPIOA_CRH</span>   <span class="keyword">EQU</span> <span class="number">0x40010804</span> 
<span class="directive">GPIOA_IDR</span>   <span class="keyword">EQU</span> <span class="number">0x40010808</span>  <span class="comment">; Input Data Register</span>
<span class="directive">GPIOA_ODR</span>   <span class="keyword">EQU</span> <span class="number">0x4001080C</span>  <span class="comment">; Output Data Register</span>
<span class="directive">GPIOA_BSRR</span>  <span class="keyword">EQU</span> <span class="number">0x40010810</span>
<span class="directive">GPIOA_BRR</span>   <span class="keyword">EQU</span> <span class="number">0x40010814</span>
<span class="directive">AFIO_MAPR</span>   <span class="keyword">EQU</span> <span class="number">0x40010004</span>

<span class="comment">; Registros da GPIOB (bot√µes SW5-SW11)</span>
<span class="directive">GPIOB_CRL</span>   <span class="keyword">EQU</span> <span class="number">0x40010C00</span>
<span class="directive">GPIOB_CRH</span>   <span class="keyword">EQU</span> <span class="directive">GPIOB_CRL</span>+<span class="number">0x04</span>
<span class="directive">GPIOB_IDR</span>   <span class="keyword">EQU</span> <span class="directive">GPIOB_CRL</span>+<span class="number">0x08</span>
<span class="directive">GPIOB_ODR</span>   <span class="keyword">EQU</span> <span class="directive">GPIOB_CRL</span>+<span class="number">0x0C</span>
<span class="directive">GPIOB_BSRR</span>  <span class="keyword">EQU</span> <span class="directive">GPIOB_CRL</span>+<span class="number">0x10</span>
<span class="directive">GPIOB_BRR</span>   <span class="keyword">EQU</span> <span class="directive">GPIOB_CRL</span>+<span class="number">0x14</span>

<span class="comment">; Registros da GPIOC (bot√µes SW15-SW17)</span>
<span class="directive">GPIOC_CRH</span>   <span class="keyword">EQU</span> <span class="number">0x40011000+0x04</span>
<span class="directive">GPIOC_IDR</span>   <span class="keyword">EQU</span> <span class="number">0x40011000+0x08</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Estes s√£o os endere√ßos de mem√≥ria dos perif√©ricos que
                        usamos no
                        STM32F103. Definimos os registradores das tr√™s portas
                        GPIO (A, B, C)
                        que controlam os pinos de entrada (bot√µes) e sa√≠da
                        (LEDs/LCD). O
                        RCC_APB2ENR habilita os clocks necess√°rios para que os
                        perif√©ricos
                        funcionem.
                    </p>
                </div>
            </div>

            <!-- SLIDE 2: Timer 3 e LCD -->
            <div id="timer-lcd" class="code-section">
                <div class="code-header">
                    <div class="code-title">Timer 3 (PWM) e Controle do
                        LCD</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="comment">; Registros do Timer 3 - Gera√ß√£o de PWM para o som</span>
<span class="directive">TIM3_BASE</span>   <span class="keyword">EQU</span> <span class="number">0x40000400</span>
<span class="directive">TIM3_PSC</span>    <span class="keyword">EQU</span> <span class="directive">TIM3_BASE</span>+<span class="number">0x28</span>  <span class="comment">; Prescaler (controla frequ√™ncia)</span>
<span class="directive">TIM3_CCR3</span>   <span class="keyword">EQU</span> <span class="directive">TIM3_BASE</span>+<span class="number">0x3C</span>  <span class="comment">; Duty Cycle (controla timbre)</span>
<span class="directive">TIM3_CCER</span>   <span class="keyword">EQU</span> <span class="directive">TIM3_BASE</span>+<span class="number">0x20</span>  <span class="comment">; Enable Output</span>
<span class="directive">TIM3_CCMR2</span>  <span class="keyword">EQU</span> <span class="directive">TIM3_BASE</span>+<span class="number">0x1C</span>  <span class="comment">; PWM Mode</span>
<span class="directive">TIM3_ARR</span>    <span class="keyword">EQU</span> <span class="directive">TIM3_BASE</span>+<span class="number">0x2C</span>  <span class="comment">; Auto-Reload (per√≠odo fixo)</span>
<span class="directive">TIM3_CR1</span>    <span class="keyword">EQU</span> <span class="directive">TIM3_BASE</span>+<span class="number">0x00</span>  <span class="comment">; Control Register</span>

<span class="directive">VALOR_ARR</span>   <span class="keyword">EQU</span> <span class="number">999</span>  <span class="comment">; ARR fixo em 999</span>

<span class="comment">; Controle do LCD (protocolo 4 bits)</span>
<span class="directive">LCD_EN</span>      <span class="keyword">EQU</span> <span class="number">0x1000</span>  <span class="comment">; PA12 - Enable</span>
<span class="directive">LCD_RS</span>      <span class="keyword">EQU</span> <span class="number">0x8000</span>  <span class="comment">; PA15 - Register Select</span>

<span class="comment">; M√°scaras de LEDs (VU Meter do duty cycle)</span>
<span class="directive">LED1</span>        <span class="keyword">EQU</span> <span class="number">0x0001</span>  <span class="comment">; PA0</span>
<span class="directive">LED2</span>        <span class="keyword">EQU</span> <span class="number">0x0002</span>  <span class="comment">; PA1</span>
<span class="directive">LED3</span>        <span class="keyword">EQU</span> <span class="number">0x0004</span>  <span class="comment">; PA2</span>
<span class="directive">LED4</span>        <span class="keyword">EQU</span> <span class="number">0x8000</span>  <span class="comment">; PA15</span>
<span class="directive">LED5</span>        <span class="keyword">EQU</span> <span class="number">0x0100</span>  <span class="comment">; PA8</span>
<span class="directive">LED6</span>        <span class="keyword">EQU</span> <span class="number">0x0040</span>  <span class="comment">; PA6</span>
<span class="directive">LED7</span>        <span class="keyword">EQU</span> <span class="number">0x0020</span>  <span class="comment">; PA5</span>
<span class="directive">LED8</span>        <span class="keyword">EQU</span> <span class="number">0x0800</span>  <span class="comment">; PA11</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        O Timer3 gera o sinal PWM que produz o som no buzzer. O
                        PSC
                        (Prescaler) controla a frequ√™ncia da nota musical, o
                        CCR3 controla o
                        duty cycle (timbre) e o ARR define o per√≠odo da onda
                        (fixo em 999).
                        Os LEDs funcionam como um VU meter visual do duty cycle
                        atual.
                    </p>
                </div>
            </div>

            <!-- SLIDE 3: Fun√ß√£o main e loop principal -->
            <div id="main" class="code-section">
                <div class="code-header">
                    <div class="code-title">Fun√ß√£o Main e Loop Principal</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">main</span>
    <span class="keyword">BL</span> <span class="label">configura_gpio</span>     <span class="comment">; Inicializa GPIOs</span>
    <span class="keyword">BL</span> <span class="label">configura_timer3</span>   <span class="comment">; Configura PWM</span>
    <span class="keyword">BL</span> <span class="label">configura_lcd</span>      <span class="comment">; Inicializa display</span>
    <span class="keyword">MOV</span> <span class="register">R10</span>, <span class="number">#1</span>             <span class="comment">; Oitava inicial = 1</span>
    <span class="keyword">BL</span> <span class="label">printa_lcd</span>         <span class="comment">; Mostra info inicial</span>

<span class="label">main_loop</span>
    <span class="keyword">BL</span> <span class="label">tecla_id</span>           <span class="comment">; Verifica bot√£o pressionado</span>
    <span class="keyword">MOV</span> <span class="register">R4</span>, <span class="register">R8</span>             <span class="comment">; R4 = c√≥digo da tecla</span>
    
    <span class="keyword">CMP</span> <span class="register">R4</span>, <span class="number">#0</span>             <span class="comment">; Nenhuma tecla?</span>
    <span class="keyword">BEQ</span> <span class="label">main_loop</span>
    
    <span class="keyword">CMP</span> <span class="register">R4</span>, <span class="number">#1</span>             <span class="comment">; SW1 (oitava 1)?</span>
    <span class="keyword">BEQ</span> <span class="label">seleciona_oitava1</span>
    
    <span class="keyword">CMP</span> <span class="register">R4</span>, <span class="number">#2</span>             <span class="comment">; SW2 (oitava 2)?</span>
    <span class="keyword">BEQ</span> <span class="label">seleciona_oitava2</span>
    
    <span class="keyword">CMP</span> <span class="register">R4</span>, <span class="number">#3</span>             <span class="comment">; SW3 (diminui timbre)?</span>
    <span class="keyword">BEQ</span> <span class="label">diminui_timbre</span>
    
    <span class="keyword">CMP</span> <span class="register">R4</span>, <span class="number">#4</span>             <span class="comment">; SW4 (aumenta timbre)?</span>
    <span class="keyword">BEQ</span> <span class="label">aumenta_timbre</span>
    
    <span class="keyword">CMP</span> <span class="register">R4</span>, <span class="number">#12</span>            <span class="comment">; SW12 (melodia)?</span>
    <span class="keyword">BEQ</span> <span class="label">call_melody</span>
    
    <span class="keyword">BL</span> <span class="label">toca_nota</span>          <span class="comment">; Toca nota musical</span>
    <span class="keyword">B</span> <span class="label">main_loop</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Esta √© a estrutura principal do programa. Primeiro
                        fazemos todas as
                        configura√ß√µes (GPIO, Timer, LCD). Depois entramos no
                        loop infinito
                        que constantemente verifica qual tecla foi pressionada e
                        executa a
                        a√ß√£o correspondente: mudar oitava (SW1/SW2), ajustar
                        timbre
                        (SW3/SW4), tocar melodia (SW12), ou tocar uma nota
                        musical
                        (SW5-SW11, SW13-SW17).
                    </p>
                </div>
            </div>

            <!-- SLIDE 4: Configura√ß√£o do Timer3 -->
            <div id="config-timer" class="code-section">
                <div class="code-header">
                    <div class="code-title">Configura√ß√£o do Timer 3 para
                        PWM</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">configura_timer3</span>
    <span class="keyword">PUSH</span> {<span class="register">LR</span>, <span class="register">R0</span>-<span class="register">R1</span>}
    
    <span class="comment">; Habilita clock do Timer 3</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">RCC_APB1ENR</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    <span class="keyword">ORR</span> <span class="register">R1</span>,<span class="register">R1</span>,<span class="number">#0x03</span>     <span class="comment">; Bits 0 e 1 (TIM2 e TIM3)</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]

    <span class="comment">; Configura ARR (per√≠odo fixo = 999)</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">TIM3_ARR</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="directive">VALOR_ARR</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]

    <span class="comment">; Configura modo PWM no canal 3</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">TIM3_CCMR2</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="number">0x0068</span>      <span class="comment">; PWM Mode 1, Preload Enable</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]

    <span class="comment">; Habilita sa√≠da do canal 3</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">TIM3_CCER</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="number">0x0100</span>      <span class="comment">; CC3E = 1</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]

    <span class="comment">; Duty cycle inicial (5%)</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">TIM3_CCR3</span>
    <span class="keyword">MOV</span> <span class="register">R1</span>,<span class="number">#50</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]

    <span class="comment">; Habilita o timer</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">TIM3_CR1</span>
    <span class="keyword">MOV</span> <span class="register">R1</span>,<span class="number">#0x01</span>        <span class="comment">; CEN = 1</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]

    <span class="keyword">POP</span> {<span class="register">R1</span>-<span class="register">R0</span>, <span class="register">LR</span>}
    <span class="keyword">BX</span> <span class="register">LR</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Esta fun√ß√£o configura o Timer3 no modo PWM. Primeiro
                        habilitamos o
                        clock, depois configuramos o ARR (per√≠odo fixo em 999),
                        o modo PWM,
                        habilitamos a sa√≠da do canal 3, definimos o duty cycle
                        inicial e
                        finalmente ligamos o timer. Com ARR fixo, s√≥ precisamos
                        mudar o PSC
                        para alterar a frequ√™ncia (nota) e o CCR3 para alterar o
                        timbre.
                    </p>
                </div>
            </div>

            <!-- SLIDE 5: Configura√ß√£o dos GPIOs -->
            <div id="config-gpio" class="code-section">
                <div class="code-header">
                    <div class="code-title">Configura√ß√£o dos GPIOs</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">configura_gpio</span>
    <span class="keyword">PUSH</span> {<span class="register">LR</span>, <span class="register">R0</span>-<span class="register">R1</span>}
    
    <span class="comment">; Habilita clock dos GPIOs A, B, C e AFIO</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">RCC_APB2ENR</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="directive">hab_gpioc_gpiob_gpioa_afio</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    
    <span class="comment">; Configura GPIOA - LEDs e LCD (sa√≠das)</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">GPIOA_CRL</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="number">0x33333333</span>  <span class="comment">; Output 50MHz, Push-pull</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">GPIOA_CRH</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="number">0x333B3333</span>  <span class="comment">; PB0 = PWM (alternate function)</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    
    <span class="comment">; Configura GPIOB - Bot√µes SW5-SW11 (entradas pull-up)</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">GPIOB_CRL</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="number">0x88888888</span>  <span class="comment">; Input with pull-up/down</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">GPIOB_CRH</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="number">0x88888888</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">GPIOB_ODR</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="number">0x0000FFFF</span>  <span class="comment">; Ativa pull-ups</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    
    <span class="comment">; Configura GPIOC - Bot√µes SW13-SW17 (entradas pull-up)</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">GPIOC_CRH</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="number">0x88888888</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    
    <span class="keyword">POP</span> {<span class="register">R1</span>-<span class="register">R0</span>, <span class="register">LR</span>}
    <span class="keyword">BX</span> <span class="register">LR</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Aqui configuramos todos os pinos das tr√™s portas GPIO.
                        GPIOA
                        controla os LEDs e o LCD (sa√≠das push-pull). GPIOB e
                        GPIOC controlam
                        os bot√µes (entradas com pull-up interno ativado). O pino
                        PB0 √©
                        configurado como fun√ß√£o alternativa para o PWM do
                        Timer3. Os
                        pull-ups garantem que os bot√µes leiam n√≠vel alto quando
                        n√£o
                        pressionados.
                    </p>
                </div>
            </div>

            <!-- SLIDE 6: Sele√ß√£o de oitavas -->
            <div id="oitavas" class="code-section">
                <div class="code-header">
                    <div class="code-title">Controle de Oitavas (SW1 e
                        SW2)</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">seleciona_oitava1</span>
    <span class="keyword">MOV</span> <span class="register">R10</span>, <span class="number">#1</span>     <span class="comment">; R10 = 1 (oitava mais grave)</span>
    <span class="keyword">BL</span> <span class="label">printa_lcd</span>   <span class="comment">; Atualiza LCD</span>
    <span class="keyword">B</span> <span class="label">main_loop</span>

<span class="label">seleciona_oitava2</span>
    <span class="keyword">MOV</span> <span class="register">R10</span>, <span class="number">#2</span>     <span class="comment">; R10 = 2 (oitava mais aguda)</span>
    <span class="keyword">BL</span> <span class="label">printa_lcd</span>   <span class="comment">; Atualiza LCD</span>
    <span class="keyword">B</span> <span class="label">main_loop</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        SW1 e SW2 controlam qual oitava est√° ativa. Quando
                        pressionados,
                        simplesmente atualizam o registrador R10 (1 para grave,
                        2 para
                        aguda) e atualizam o display LCD. Depois, quando uma
                        nota √© tocada,
                        a fun√ß√£o toca_nota consulta R10 para saber qual tabela
                        de
                        frequ√™ncias usar (notas_1 ou notas_2).
                    </p>
                </div>
            </div>

            <!-- SLIDE 7: Ajuste de timbre -->
            <div id="timbre" class="code-section">
                <div class="code-header">
                    <div class="code-title">Ajuste de Timbre/Duty Cycle (SW3 e
                        SW4)</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="comment">; Aumenta duty cycle em 5%</span>
<span class="label">aumenta_timbre</span>
    <span class="keyword">PUSH</span> {<span class="register">LR</span>, <span class="register">R0</span>-<span class="register">R1</span>}
    
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">TIM3_CCR3</span>   <span class="comment">; Endere√ßo do duty cycle</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,[<span class="register">R0</span>]         <span class="comment">; L√™ valor atual</span>
    <span class="keyword">CMP</span> <span class="register">R1</span>, <span class="number">#940</span>        <span class="comment">; Limite m√°ximo (94%)</span>
    <span class="keyword">ADDLE</span> <span class="register">R1</span>, <span class="register">R1</span>, <span class="number">#50</span>   <span class="comment">; +5% (50 de 1000)</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]         <span class="comment">; Atualiza</span>
    
    <span class="keyword">BL</span> <span class="label">printa_lcd</span>       <span class="comment">; Atualiza display</span>
    
    <span class="keyword">POP</span> {<span class="register">R1</span>-<span class="register">R0</span>, <span class="register">LR</span>}
    <span class="keyword">BX</span> <span class="register">LR</span>

<span class="comment">; Diminui duty cycle em 5%</span>
<span class="label">diminui_timbre</span>
    <span class="keyword">PUSH</span> {<span class="register">LR</span>, <span class="register">R0</span>-<span class="register">R1</span>}
    
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">TIM3_CCR3</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    <span class="keyword">CMP</span> <span class="register">R1</span>, <span class="number">#90</span>          <span class="comment">; Limite m√≠nimo (9%)</span>
    <span class="keyword">SUBGE</span> <span class="register">R1</span>, <span class="register">R1</span>, <span class="number">#50</span>   <span class="comment">; -5%</span>
    <span class="keyword">STR</span> <span class="register">R1</span>,[<span class="register">R0</span>]
    
    <span class="keyword">BL</span> <span class="label">printa_lcd</span>
    
    <span class="keyword">POP</span> {<span class="register">R1</span>-<span class="register">R0</span>, <span class="register">LR</span>}
    <span class="keyword">BX</span> <span class="register">LR</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        O timbre √© controlado mudando o duty cycle (CCR3) da
                        onda quadrada.
                        Com ARR=999, temos 1000 steps totais. Cada
                        incremento/decremento de
                        50 representa aproximadamente 5% de mudan√ßa. SW3 aumenta
                        (at√© 94%) e
                        SW4 diminui (at√© 9%). Mudar o duty cycle altera o
                        "colorido" do som
                        mantendo a mesma frequ√™ncia.
                    </p>
                </div>
            </div>

            <!-- SLIDE 8: VU Meter dos LEDs -->
            <div id="leds" class="code-section">
                <div class="code-header">
                    <div class="code-title">
                        VU Meter - LEDs Proporcionais ao Duty Cycle
                    </div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">printa_duty</span>
    <span class="keyword">PUSH</span> {<span class="register">LR</span>, <span class="register">R0</span>-<span class="register">R7</span>}
    
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">GPIOA_ODR</span>   <span class="comment">; Registrador de sa√≠da</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="directive">TIM3_CCR3</span>   <span class="comment">; Duty cycle</span>
    <span class="keyword">LDR</span> <span class="register">R2</span>,[<span class="register">R1</span>]         <span class="comment">; Valor (0-1000)</span>
    <span class="keyword">LDR</span> <span class="register">R5</span>,=<span class="label">leds</span>        <span class="comment">; Tabela de m√°scaras</span>
    <span class="keyword">MOV</span> <span class="register">R3</span>, <span class="number">#0</span>          <span class="comment">; Contador</span>
    <span class="keyword">MOV</span> <span class="register">R7</span>, <span class="number">#0</span>          <span class="comment">; Acumulador de LEDs</span>
    
<span class="label">loop</span>
    <span class="keyword">CMP</span> <span class="register">R2</span>, <span class="register">R3</span>          <span class="comment">; Compara duty com contador</span>
    <span class="keyword">ADDGT</span> <span class="register">R3</span>, <span class="register">R3</span>, <span class="number">#130</span>  <span class="comment">; Incrementa ~12.5% (1000/8)</span>
    <span class="keyword">LDR</span> <span class="register">R6</span>, [<span class="register">R5</span>]        <span class="comment">; Carrega m√°scara do LED</span>
    <span class="keyword">ADD</span> <span class="register">R5</span>, <span class="register">R5</span>, <span class="number">#4</span>      <span class="comment">; Pr√≥ximo LED</span>
    <span class="keyword">ORRGT</span> <span class="register">R7</span>, <span class="register">R7</span>, <span class="register">R6</span>    <span class="comment">; Se duty > contador, acende LED</span>
    <span class="keyword">BGT</span> <span class="label">loop</span>
    
    <span class="keyword">STR</span> <span class="register">R7</span>, [<span class="register">R0</span>]        <span class="comment">; Escreve nos LEDs</span>
    
    <span class="keyword">POP</span> {<span class="register">R7</span>-<span class="register">R0</span>, <span class="register">LR</span>}
    <span class="keyword">BX</span> <span class="register">LR</span>

<span class="comment">; Tabela de m√°scaras dos LEDs</span>
<span class="label">leds</span>   <span class="keyword">DCD</span> <span class="directive">LED8</span>, <span class="directive">LED7</span>, <span class="directive">LED6</span>, <span class="directive">LED5</span>, <span class="directive">LED4</span>, <span class="directive">LED3</span>, <span class="directive">LED2</span>, <span class="directive">LED1</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Esta rotina cria um VU meter visual usando os 8 LEDs.
                        Divide o duty
                        cycle (0-1000) em 8 faixas de aproximadamente 130 cada.
                        Para cada
                        faixa atingida pelo duty cycle atual, acende um LED.
                        Resultado: duty
                        50% = 4 LEDs acesos, duty 100% = todos os 8 LEDs acesos.
                        √â uma
                        representa√ß√£o visual em tempo real do timbre
                        selecionado.
                    </p>
                </div>
            </div>

            <!-- SLIDE 9: Atualiza√ß√£o do LCD -->
            <div id="lcd" class="code-section">
                <div class="code-header">
                    <div class="code-title">Atualiza√ß√£o do Display LCD</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">printa_lcd</span>
    <span class="keyword">PUSH</span> {<span class="register">LR</span>, <span class="register">R0</span>-<span class="register">R5</span>}
    
    <span class="comment">; Limpa display e posiciona cursor</span>
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="number">#0x01</span>       <span class="comment">; Clear display</span>
    <span class="keyword">BL</span> <span class="label">comando_lcd</span>
    <span class="keyword">BL</span> <span class="label">delay_lcd</span>
    
    <span class="comment">; Imprime "Oitava: X"</span>
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="string">'O'</span>
    <span class="keyword">BL</span> <span class="label">escreve_char_lcd</span>
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="string">'i'</span>
    <span class="keyword">BL</span> <span class="label">escreve_char_lcd</span>
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="string">'t'</span>
    <span class="keyword">BL</span> <span class="label">escreve_char_lcd</span>
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="string">'a'</span>
    <span class="keyword">BL</span> <span class="label">escreve_char_lcd</span>
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="string">':'</span>
    <span class="keyword">BL</span> <span class="label">escreve_char_lcd</span>
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="string">' '</span>
    <span class="keyword">BL</span> <span class="label">escreve_char_lcd</span>
    
    <span class="comment">; Imprime n√∫mero da oitava (R10)</span>
    <span class="keyword">ADD</span> <span class="register">R0</span>, <span class="register">R10</span>, <span class="number">#48</span>   <span class="comment">; Converte para ASCII</span>
    <span class="keyword">BL</span> <span class="label">escreve_char_lcd</span>
    
    <span class="comment">; Segunda linha: "Duty: XX%"</span>
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="number">#0xC0</span>       <span class="comment">; Posi√ß√£o linha 2</span>
    <span class="keyword">BL</span> <span class="label">comando_lcd</span>
    
    <span class="comment">; ... imprime "Duty: "</span>
    
    <span class="comment">; Calcula e imprime porcentagem</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="directive">TIM3_CCR3</span>
    <span class="keyword">LDR</span> <span class="register">R2</span>,[<span class="register">R1</span>]
    <span class="keyword">MOV</span> <span class="register">R3</span>, <span class="number">#10</span>
    <span class="keyword">UDIV</span> <span class="register">R2</span>, <span class="register">R2</span>, <span class="register">R3</span>   <span class="comment">; Divide por 10 (0-100%)</span>
    <span class="keyword">BL</span> <span class="label">print_double_digit</span>
    
    <span class="keyword">MOV</span> <span class="register">R0</span>, <span class="string">'%'</span>
    <span class="keyword">BL</span> <span class="label">escreve_char_lcd</span>
    
    <span class="keyword">BL</span> <span class="label">printa_duty</span>     <span class="comment">; Atualiza LEDs tamb√©m</span>
    
    <span class="keyword">POP</span> {<span class="register">R5</span>-<span class="register">R0</span>, <span class="register">LR</span>}
    <span class="keyword">BX</span> <span class="register">LR</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Esta fun√ß√£o atualiza o display LCD com as informa√ß√µes
                        atuais. Na
                        primeira linha mostra a oitava selecionada (1 ou 2). Na
                        segunda
                        linha mostra o duty cycle atual em porcentagem. Usa
                        protocolo 4 bits
                        para comunica√ß√£o com o LCD, enviando comandos de
                        controle e dados de
                        caracteres. Tamb√©m chama printa_duty para atualizar os
                        LEDs
                        simultaneamente.
                    </p>
                </div>
            </div>

            <!-- SLIDE 10: Tabelas de frequ√™ncias -->
            <div id="tabelas" class="code-section">
                <div class="code-header">
                    <div class="code-title">
                        Tabelas de Frequ√™ncias das Notas Musicais
                    </div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="comment">; Tabela de mapeamento: tecla f√≠sica ‚Üí √≠ndice da nota</span>
            <span class="keyword">AREA</span> <span class="label">t_p_n</span>, <span class="directive">DATA</span>, <span class="directive">READONLY</span>
<span class="label">teclas</span>      <span class="keyword">DCD</span>  <span class="number">5, 13, 6, 14, 7, 8, 15, 9, 16, 10, 17, 11, 12, 0</span>

<span class="comment">; Oitava 1 (grave): PSC para cada nota</span>
<span class="comment">; F√≥rmula: freq = 72MHz / (PSC+1) / 1000</span>
            <span class="keyword">AREA</span> <span class="label">O_1</span>, <span class="directive">DATA</span>, <span class="directive">READONLY</span>
<span class="label">notas_1</span>     <span class="keyword">DCD</span> <span class="number">0, 274, 259, 244, 230, 217, 205, 194, 183, 172, 163, 153, 145, 0</span>
<span class="comment">;           √çndices:  C   C#   D   D#   E   F   F#   G   G#   A   A#   B</span>

<span class="comment">; Oitava 2 (aguda): frequ√™ncias 2x maiores = PSC metade</span>
            <span class="keyword">AREA</span> <span class="label">O_2</span>, <span class="directive">DATA</span>, <span class="directive">READONLY</span>
<span class="label">notas_2</span>     <span class="keyword">DCD</span> <span class="number">0, 137, 129, 122, 115, 108, 102, 96, 91, 86, 81, 76, 72, 0</span>
<span class="comment">;           √çndices:  C   C#   D   D#   E   F   F#  G   G#  A   A#  B</span>

<span class="comment">; Melodia autom√°tica (SW12) - "Brilha Brilha Estrelinha"</span>
            <span class="keyword">AREA</span> <span class="label">melodia</span>, <span class="directive">DATA</span>, <span class="directive">READONLY</span>
<span class="label">notasM</span>      <span class="keyword">DCD</span> <span class="number">0, 274, 0, 274, 0, 183, 0, 183...</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        As tabelas cont√™m valores de PSC pr√©-calculados para
                        cada nota
                        musical. Com ARR=999, a f√≥rmula para calcular a
                        frequ√™ncia √©: f =
                        72MHz / (PSC+1) / 1000. Por exemplo, para D√≥ (261.63
                        Hz): PSC =
                        (72.000.000 / 261.63 / 1000) - 1 ‚âà 274. A oitava 2 tem
                        frequ√™ncias
                        2x maiores, ent√£o PSC √© aproximadamente metade da oitava
                        1.
                    </p>
                </div>
            </div>

            <!-- SLIDE 11: Scan de teclas -->
            <div id="scan" class="code-section">
                <div class="code-header">
                    <div class="code-title">Scan de Teclas - Leitura dos
                        GPIOs</div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">tecla_id</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">GPIOA_IDR</span>   <span class="comment">; L√™ porta A</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="directive">GPIOB_IDR</span>   <span class="comment">; L√™ porta B</span>
    <span class="keyword">LDR</span> <span class="register">R2</span>,=<span class="directive">GPIOC_IDR</span>   <span class="comment">; L√™ porta C</span>
    <span class="keyword">LDR</span> <span class="register">R3</span>,[<span class="register">R0</span>]
    <span class="keyword">LDR</span> <span class="register">R4</span>,[<span class="register">R1</span>]
    <span class="keyword">LDR</span> <span class="register">R5</span>,[<span class="register">R2</span>]
    <span class="keyword">MOV</span> <span class="register">R8</span>, <span class="number">#0</span>          <span class="comment">; R8 = resultado (nenhuma tecla)</span>

    <span class="keyword">LSL</span> <span class="register">R3</span>, <span class="number">#16</span>         <span class="comment">; Posiciona bits</span>
    <span class="keyword">LSL</span> <span class="register">R4</span>, <span class="number">#16</span>
    <span class="keyword">LSL</span> <span class="register">R5</span>, <span class="number">#16</span>
    
    <span class="comment">; Testa SW4 (bit 15 de GPIOB)</span>
    <span class="keyword">LSLS</span> <span class="register">R4</span>, <span class="number">#1</span>         <span class="comment">; Desloca, √∫ltimo bit vai para carry</span>
    <span class="keyword">ORRCC</span> <span class="register">R8</span>, <span class="register">R8</span>, <span class="number">#4</span>    <span class="comment">; Se carry clear (0), tecla pressionada</span>
    <span class="keyword">BXCC</span> <span class="register">LR</span>             <span class="comment">; Retorna imediatamente</span>

    <span class="comment">; Testa SW3 (bit 14 de GPIOB)</span>
    <span class="keyword">LSLS</span> <span class="register">R4</span>, <span class="number">#1</span>
    <span class="keyword">ORRCC</span> <span class="register">R8</span>, <span class="register">R8</span>, <span class="number">#3</span>
    <span class="keyword">BXCC</span> <span class="register">LR</span>

    <span class="comment">; ... (continua para SW2, SW1, SW5-SW17) ...</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Esta fun√ß√£o faz o scan de todos os bot√µes conectados nos
                        tr√™s GPIOs.
                        L√™ os registradores de entrada (IDR) das tr√™s portas,
                        usa LSLS
                        (shift left set flags) para deslocar os bits um por um,
                        e testa o
                        carry flag. Como os bot√µes usam l√≥gica negativa
                        (pull-up), carry
                        clear (0) indica bot√£o pressionado. Retorna o n√∫mero da
                        tecla
                        pressionada em R8 (1-17).
                    </p>
                </div>
            </div>

            <!-- SLIDE 12: Tocar nota -->
            <div id="tocar" class="code-section">
                <div class="code-header">
                    <div class="code-title">
                        Reprodu√ß√£o de Notas - Configura√ß√£o do Timer
                    </div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">toca_nota</span>
    <span class="keyword">PUSH</span> {<span class="register">LR</span>, <span class="register">R0</span>-<span class="register">R6</span>}
    
    <span class="comment">; Seleciona tabela baseada na oitava (R10)</span>
    <span class="keyword">CMP</span> <span class="register">R10</span>, <span class="number">#2</span>
    <span class="keyword">BEQ</span> <span class="label">usa_notas2</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="label">notas_1</span>+<span class="number">4</span>   <span class="comment">; Oitava 1 (grave)</span>
    <span class="keyword">B</span> <span class="label">seleciona_nota</span>
    
<span class="label">usa_notas2</span>
    <span class="keyword">LDR</span> <span class="register">R1</span>,=<span class="label">notas_2</span>+<span class="number">4</span>   <span class="comment">; Oitava 2 (aguda)</span>

<span class="label">seleciona_nota</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>,=<span class="directive">TIM3_PSC</span>    <span class="comment">; Endere√ßo do Prescaler</span>
    <span class="keyword">LDR</span> <span class="register">R2</span>,=<span class="label">teclas</span>      <span class="comment">; Tabela de mapeamento</span>
    <span class="keyword">MOV</span> <span class="register">R3</span>, <span class="number">#0</span>          <span class="comment">; √çndice</span>
    <span class="keyword">MOV</span> <span class="register">R5</span>, <span class="number">#0</span>

<span class="label">loop_tecla</span>
    <span class="keyword">LDR</span> <span class="register">R5</span>, [<span class="register">R2</span>, <span class="register">R3</span>, <span class="directive">LSL</span> <span class="number">#2</span>]  <span class="comment">; Busca tecla na tabela</span>
    <span class="keyword">CMP</span> <span class="register">R5</span>, <span class="register">R4</span>                <span class="comment">; Compara com tecla pressionada</span>
    <span class="keyword">ADDNE</span> <span class="register">R3</span>, <span class="register">R3</span>, <span class="number">#1</span>          <span class="comment">; Se diferente, pr√≥ximo √≠ndice</span>
    <span class="keyword">BNE</span> <span class="label">loop_tecla</span>
    
    <span class="comment">; Achou! Carrega PSC correspondente</span>
    <span class="keyword">LDR</span> <span class="register">R6</span>, [<span class="register">R1</span>, <span class="register">R3</span>, <span class="directive">LSL</span> <span class="number">#2</span>]  <span class="comment">; notas_X[√≠ndice]</span>
    <span class="keyword">STR</span> <span class="register">R6</span>, [<span class="register">R0</span>]              <span class="comment">; Escreve no Timer</span>
    
    <span class="keyword">POP</span> {<span class="register">R6</span>-<span class="register">R0</span>, <span class="register">LR</span>}
    <span class="keyword">BX</span> <span class="register">LR</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Esta √© a fun√ß√£o central que toca as notas musicais.
                        Recebe o n√∫mero
                        da tecla pressionada (em R4), usa a tabela 'teclas' para
                        converter
                        em √≠ndice da nota (0-12), verifica qual oitava est√°
                        selecionada
                        (R10), seleciona a tabela correspondente (notas_1 ou
                        notas_2), busca
                        o valor de PSC nessa tabela e finalmente escreve no
                        Timer3. Tudo
                        isso acontece quase instantaneamente!
                    </p>
                </div>
            </div>

            <!-- SLIDE 13: Melodia autom√°tica -->
            <div id="melodia" class="code-section">
                <div class="code-header">
                    <div class="code-title">
                        Funcionalidade Extra - Melodia Autom√°tica (SW12)
                    </div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="label">call_melody</span>
    <span class="keyword">PUSH</span> {<span class="register">LR</span>, <span class="register">R0</span>-<span class="register">R3</span>, <span class="register">R5</span>-<span class="register">R7</span>}

    <span class="keyword">LDR</span> <span class="register">R1</span>, =<span class="label">notasM</span>      <span class="comment">; Tabela de notas da melodia</span>
    <span class="keyword">LDR</span> <span class="register">R0</span>, =<span class="directive">TIM3_PSC</span>    <span class="comment">; Endere√ßo do PSC</span>
    <span class="keyword">MOV</span> <span class="register">R3</span>, <span class="number">#1</span>           <span class="comment">; √çndice inicial</span>

<span class="label">loopM</span>
    <span class="keyword">CMP</span> <span class="register">R3</span>, <span class="number">#64</span>          <span class="comment">; 64 notas na melodia</span>
    <span class="keyword">BGE</span> <span class="label">fim_melody</span>

    <span class="keyword">LDR</span> <span class="register">R6</span>, [<span class="register">R1</span>, <span class="register">R3</span>, <span class="directive">LSL</span> <span class="number">#2</span>]  <span class="comment">; Carrega PSC da nota</span>
    <span class="keyword">STR</span> <span class="register">R6</span>, [<span class="register">R0</span>]              <span class="comment">; Configura Timer</span>
    
    <span class="keyword">BL</span> <span class="label">delay_melody</span>           <span class="comment">; Aguarda dura√ß√£o</span>
    
    <span class="keyword">ADD</span> <span class="register">R3</span>, <span class="register">R3</span>, <span class="number">#1</span>            <span class="comment">; Pr√≥xima nota</span>
    <span class="keyword">B</span> <span class="label">loopM</span>

<span class="label">fim_melody</span>
    <span class="keyword">POP</span> {<span class="register">R7</span>-<span class="register">R5</span>, <span class="register">R3</span>-<span class="register">R0</span>, <span class="register">LR</span>}
    <span class="keyword">BX</span> <span class="register">LR</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        Funcionalidade extra implementada no SW12: toca uma
                        melodia
                        pr√©-programada automaticamente. O loop percorre a tabela
                        notasM (64
                        posi√ß√µes), carrega cada valor de PSC sequencialmente,
                        configura o
                        Timer3 e aguarda um delay entre as notas. √â uma
                        demonstra√ß√£o de como
                        podemos criar sequ√™ncias musicais autom√°ticas usando o
                        mesmo sistema
                        de gera√ß√£o de frequ√™ncias.
                    </p>
                </div>
            </div>

            <!-- SLIDE 14: Potenci√¥metro -->
            <div id="potenciometro" class="code-section">
                <div class="code-header">
                    <div class="code-title">
                        Sobre o Potenci√¥metro - Por que n√£o foi implementado?
                    </div>
                    <div class="window-controls">
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                        <div class="window-btn"></div>
                    </div>
                </div>
                <div class="code-content">
                    <pre><span class="comment">; Registros ADC que seriam usados:</span>
                <span class="directive">ADC1_BASE</span>   <span class="keyword">EQU</span> <span class="number">0x40012400</span>
                <span class="directive">ADC1_SR</span>     <span class="keyword">EQU</span> <span class="directive">ADC1_BASE</span>+<span class="number">0x0000</span>  <span class="comment">; Status Register</span>
                <span class="directive">ADC1_DR</span>     <span class="keyword">EQU</span> <span class="directive">ADC1_BASE</span>+<span class="number">0x004C</span>  <span class="comment">; Data Register (0-4095)</span>
                <span class="directive">ADC1_CR2</span>    <span class="keyword">EQU</span> <span class="directive">ADC1_BASE</span>+<span class="number">0x0008</span>  <span class="comment">; Control Register 2</span>
                <span class="directive">ADC1_SMPR2</span>  <span class="keyword">EQU</span> <span class="directive">ADC1_BASE</span>+<span class="number">0x0010</span>  <span class="comment">; Sample Time Register</span>
                <span class="directive">ADC1_SQR3</span>   <span class="keyword">EQU</span> <span class="directive">ADC1_BASE</span>+<span class="number">0x0034</span>  <span class="comment">; Sequence Register</span>

                <span class="comment">; Implementa√ß√£o planejada do pitch bend:</span>
                <span class="comment">;</span>
                <span class="comment">; 1. Configurar ADC para ler potenci√¥metro continuamente</span>
                <span class="comment">; 2. Fazer convers√µes A/D em loop durante nota pressionada</span>
                <span class="comment">; 3. Mapear valor ADC (0-4095) para range de frequ√™ncia:</span>
                <span class="comment">;    - Potenci√¥metro m√≠nimo: nota base (ex: D√≥ = PSC 274)</span>
                <span class="comment">;    - Potenci√¥metro m√°ximo: +1 tom (R√© = PSC 244)</span>
                <span class="comment">;    - Valores intermedi√°rios: interpola√ß√£o linear</span>
                <span class="comment">; 4. Atualizar TIM3_PSC em tempo real baseado na leitura</span>
                <span class="comment">;</span>
                <span class="comment">; Desafio: Ru√≠do e instabilidade nas leituras do ADC</span></pre>
                </div>
                <div class="explanation">
                    <h3>Explica√ß√£o</h3>
                    <p>
                        <strong>O potenci√¥metro implementaria o efeito de
                            "pitch bend"</strong>
                        - um aumento gradual e cont√≠nuo da frequ√™ncia da nota
                        conforme o
                        potenci√¥metro √© girado.
                    </p>
                    <p>
                        <strong>Implementa√ß√£o planejada:</strong> Configurar o
                        ADC para ler
                        o potenci√¥metro continuamente, mapear o valor lido
                        (0-4095) para um
                        range de PSC entre a nota base e +1 tom, e atualizar o
                        Timer3 em
                        tempo real.
                    </p>
                    <p>
                        <strong>Por que n√£o foi implementado?</strong> O
                        principal desafio
                        foi que as leituras do ADC apresentaram muita
                        instabilidade e ru√≠do
                        el√©trico, causando varia√ß√µes indesejadas e "glitches"
                        aud√≠veis na
                        frequ√™ncia. Tentamos implementar filtros de m√©dia m√≥vel,
                        mas o som
                        ainda ficava inconsistente. Portanto, priorizamos
                        entregar essas
                        funcionalidades principais funcionando perfeitamente.
                    </p>
                </div>
            </div>
        </div>

        <script>
      function scrollToSection(id) {
        const element = document.getElementById(id);
        if (element) {
          element.scrollIntoView({ behavior: "smooth", block: "start" });

          // Update active nav item
          document.querySelectorAll(".nav-item").forEach((item) => {
            item.classList.remove("active");
          });
          event.target.classList.add("active");
        }
      }

      // Intersection Observer for nav highlighting
      const sections = document.querySelectorAll(".code-section");
      const navItems = document.querySelectorAll(".nav-item");

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const id = entry.target.id;
              navItems.forEach((item, index) => {
                item.classList.remove("active");
                if (item.getAttribute("onclick").includes(id)) {
                  item.classList.add("active");
                }
              });
            }
          });
        },
        { threshold: 0.5 }
      );

      sections.forEach((section) => observer.observe(section));
    </script>
    </body>
</html>
